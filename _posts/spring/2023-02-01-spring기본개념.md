---
title: Spring Security ê¸°ë³¸ ê°œë…
date: 2023-02-01
categories: [Spring, security]
tags: [spring-security]
math: true
mermaid: true
---

## ë“¤ì–´ê°€ê¸°ì „..

Springì—ì„œ ì¸ì¦, ì¸ê°€ ë° ë³´ì•ˆì— ëŒ€í•´ ê¸°ëŠ¥ì„ ì œê³µí•´ì£¼ëŠ” í”„ë ˆì„ì›Œí¬ ì…ë‹ˆë‹¤.<br>
Documentì—ì„œë„ ì‚¬ì‹¤ìƒ í‘œì¤€ì´ë¼ê³  ë§í•˜ê³  ìˆëŠ” Spring securityì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê³  ë‚´ìš©ì„ ì •ë¦¬í•˜ê³ ì í•©ë‹ˆë‹¤. ìµœì†Œ í™˜ê²½ìœ¼ë¡œëŠ” Java 8 ì´ìƒì—ì„œ ë™ì‘í•©ë‹ˆë‹¤.
ë˜í•œ í¬ê²Œ servlet ë°©ì‹ê³¼ reactiveë°©ì‹ì´ ìˆëŠ”ë°, Servletë°©ì‹ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.


## Spring security ê¸°ë³¸ê°œë…

spring securityì—ì„œëŠ” Servlet Filterê°œë…ì„ í†µí•´ì„œ ë³´ì•ˆê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

<center>
<img src="https://user-images.githubusercontent.com/39672033/221595975-31846081-0aea-4349-b480-0b233efc6592.png">
</center>

Servlet Containerì—ì„œ ê´€ë¦¬í•˜ëŠ” Filter <br>
ìœ„ ê·¸ë¦¼ì²˜ëŸ¼ ì—¬ëŸ¬ê°œì˜ Filterë“¤ì„ ê°€ì§€ê³  Clientì—ì„œ ìš”ì²­í•œ Requestë¥¼ í•„í„°ë§í•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ Servletê¹Œì§€ ì „ë‹¬í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<aside class="searched-words">
  âš ï¸ Servlet Filterë¡œ ë™ì‘í•œë‹¤ëŠ” ë§ì€ ë‹¤ì‹œë§í•˜ë©´ ìŠ¤í”„ë§ ë¹ˆì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ë§ì¸ë°ìš”. ê·¸ë ‡ë‹¤ë©´ ë¡œê·¸ì¸ ë“± ìŠ¤í”„ë§ ë¹ˆì´ í•„ìš”í•œ ê²½ìš° ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œìš”?
</aside>


### Servlet Container vs Spring Container

<center>
<img src="https://user-images.githubusercontent.com/39672033/221596129-a3b9a8e1-eda7-405c-be1e-0a466a320012.png" height="300px" width="600px">
</center>> 

Servlet Filterë“¤ì€ ê¸°ë³¸ì ìœ¼ë¡œ Servlet Containerë“¤ì´ ë¼ì´í”„ ì‚¬ì´í´ì„ ê´€ë¦¬í•˜ë©°, Spring Beanì€ Spring Containerë“¤ì´ ë¼ì´í”„ ì‚¬ì´í´ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.<br>
ë”°ë¼ì„œ ì„œë¡œ ê´€ë¦¬í•˜ëŠ” Containerë“¤ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ê¸°ê°€ ì–´ë ¤ìš´ë°ìš”!<br>
ì´ë¥¼ Spring Securityì—ì„œëŠ” DelegatingFilterProxyë¼ëŠ” ProxyíŒ¨í„´ì„ ì´ìš©í•˜ì—¬ Spring Beanì—ê²Œ ìš”ì²­ì„ ìœ„ì„í•˜ì—¬ ì²˜ë¦¬ë¥¼ í•˜ê²Œë©ë‹ˆë‹¤.

### ğŸ¤”Â DelegatingFilterProxyë€ ë¬´ì—‡ì¼ê¹Œìš”?

Java docsë¥¼ ì‚´í´ë³´ë©´ DelegatingFilterProxyì— ëŒ€í•´ì„œ ì•„ë˜ì™€ ê°™ì€ ì—­í• ì„ í•œë‹¤ê³  ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.

> Proxy for a standard Servlet Filter, delegating to a Spring-managed bean that implements the Filter interface
ìŠ¤í”„ë§ ë¹ˆì´ ê´€ë¦¬í•˜ëŠ” í•„í„°ë“¤ì— ìœ„ì„í•˜ëŠ” í‘œì¤€ ì„œë¸”ë¦¿ í•„í„° í”„ë¡ì‹œ
>

ì‹¤ì œ DelegatingFilterProxy.java ë‚´ë¶€ë¥¼ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ë‹¤ì–‘í•œ í•„í„°ë“¤ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°ìš”. ì´ í•„í„°ë“¤ì€ ì‹¤ì œ ìœ„ì„ ëŒ€ìƒì¸ Spring Beanì—ì„œ ê´€ë¦¬í•˜ëŠ” Filterë“¤ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.(FilterChainProxy)

<center>
<img src="https://user-images.githubusercontent.com/39672033/221598244-9af82877-1a7c-49c9-adc5-ec1a518c0887.png" height="300px" width="600px"/>
</center>

ì¦‰ DelegatingFilterProxyëŠ” ì„œí”Œë¦¿ í•„í„°ì´ë©°, Spring Containerê°€ ê´€ë¦¬í•˜ëŠ” ìŠ¤í”„ë§ ë¹ˆë“¤ ì¤‘ í•„í„°ë“¤ì„ ê°€ì§€ê³  ìˆìœ¼ë©° ì´ë“¤ì€ SecurityFilterChain ë‹¨ìœ„ë¡œ ë¬¶ì–´ì„œ ê´€ë¦¬ë˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.([ê³µì‹ë¬¸ì„œì™€ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.](https://docs.spring.io/spring-security/reference/servlet/architecture.html))

### DelegatingFilterProxy ìƒì„±ì‹œì 

DelegatingFilterProxyì˜ ì´ˆê¸°í™” ë¶€ë¶„ì„ ë³´ë©´ targetBeanNameì— í•´ë‹¹í•˜ëŠ” ë¹ˆì´ ìˆì–´ì•¼ë§Œ ì´ˆê¸°í™”ë¥¼ í•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
//DelegatingFilterProxy.java
protected Filter initDelegate(WebApplicationContext wac) throws ServletException {
	String targetBeanName = getTargetBeanName();
	Assert.state(targetBeanName != null, "No target bean name set");
	Filter delegate = wac.getBean(targetBeanName, Filter.class);
	if (isTargetFilterLifecycle()) {
		delegate.init(getFilterConfig());
	}
	return delegate;
}
```

ì—¬ê¸°ì„œ ë§í•˜ëŠ” targetBeanNameì€ springSecurityFilterChainì´ë©° Gradleì— ì˜ì¡´ì„±ë§Œ ì¶”ê°€í•´ì£¼ë©´ ì•Œì•„ì„œ í•´ë‹¹ ë¹ˆì´ ìƒì„±ë©ë‹ˆë‹¤.

> `implementation group: 'org.springframework.boot', name: 'spring-boot-starter-security'`
>

ì •í™•íˆëŠ” `SecurityFilterAutoConfiguration` í´ë˜ìŠ¤ì—ì„œ DEFAULT_FILTER_NAMEì˜ ìƒìˆ˜ê°’ì´ springSecurityFilterChainì„ìœ¼ë¡œ í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ë¹ˆì´ ìƒì„±ë©ë‹ˆë‹¤. ë˜í•œ DelegatingFilterProxyRegistrationBeanì—ì„œ DelegatingFilterProxyë¥¼ ë§Œë“œëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
//SecurityFilterAutoConfiguration.java
@Bean
@ConditionalOnBean(name = DEFAULT_FILTER_NAME)
public DelegatingFilterProxyRegistrationBean securityFilterChainRegistration(
		SecurityProperties securityProperties) {
	DelegatingFilterProxyRegistrationBean registration = new DelegatingFilterProxyRegistrationBean(
			DEFAULT_FILTER_NAME);
	registration.setOrder(securityProperties.getFilter().getOrder());
	registration.setDispatcherTypes(getDispatcherTypes(securityProperties));
	return registration;
}

//DelegatingFilterProxyRegistrationBean.java
@Override
public DelegatingFilterProxy getFilter() {
	return new DelegatingFilterProxy(this.targetBeanName, getWebApplicationContext()) {

		@Override
		protected void initFilterBean() throws ServletException {
			// Don't initialize filter bean on init()
		}

	};
}
```

## ì •ë¦¬

ì ê·¸ëŸ¬ë©´ ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ë‚´ìš©ì„ ì •ë¦¬í•´ ë³´ê² ìŠµë‹ˆë‹¤.

Spring SecurityëŠ” Servlet Filterê¸°ë°˜ì„ìœ¼ë¡œ SpringBeanì˜ ê¸°ëŠ¥ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ì´ë¥¼ ìœ„í•´ DelegatingFilterProxyê°€ ë‚˜íƒ€ë‚˜ê²Œ ë˜ì—ˆìœ¼ë©° DeletaingFilterProxyëŠ” Servlet Filterì—ì„œ ë°›ì€ ìš”ì²­ì„ ìˆ˜ì‹ í•˜ì—¬ Spring Beanì—ì„œ ê´€ë¦¬í•˜ëŠ” í•„í„°ë“¤ ì¤‘ ê°€ì¥ ë¨¼ì € ìˆ˜ì‹ í•˜ê²Œ ëœë‹¤.

ë˜í•œ DelegatingFilterProxyëŠ” SecurityFilterChainë‹¨ìœ„ë¡œ ë¬¶ì–´ Spring Beanì˜ í•„í„°ë“¤ì„ ê´€ë¦¬í•œë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ SecurityFilterAutoConfigurationì„ í†µí•´ì„œ DelegatingFilterProxyRegistrationBeanì„ ìƒì„±í•˜ê³  í•´ë‹¹ ë¹ˆì—ì„œ DelegatingFilterProxyë¥¼ ìƒì„±í•œë‹¤.
