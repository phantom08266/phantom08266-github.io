---
title: RealMySql 8.0 - 바이너리 로그 암호화
date: 2023-09-15
categories: [도서, RealMySql]
tags: [mysql, RealMySql, 바이너리 로그 암호화]
math: true
mermaid: true
---

테이블 암호화가 적용되어도 리두, 언두 로그 처럼 바이너리 로그도 암호화가 되지 않는다. 
상황에 따라서는 바이너리 로그가 더 보안에 취약할 수 있다.

따라서 바이너리 로그, 릴레이 로그 파일도 암호화를 해서 보안에 신경써야 한다. 


다만 언두, 리두 로그처럼 테이블 암호화한 마스터 키를  같이 사용하지는 않는다.
따라서 별도의 마스터 키를 만들어야 한다.

바이너리 로그 암호화 키는 아래와 같은 명령어로 생성하거나 변경할 수 있다.
~~~shell
Mysql> ALTER INSTANCE ROTATE BINLOG MASTER KEY;
~~~

동작방식은 앞서 학습한 테이블 암호화하는 것과 유사하게 동작한다. 
마스터 키를 기준으로 바이너리 로그와 릴레이 로그 파일을 암호화해서 헤더에 저장한다.


### 동작방식
	1. 바이너리 로그 암호화 키는 생성될때마다 시퀀스를 가지며 키링 파일에 저장한다.
	2. 바이너리 로그 파일과 릴레이 로그 파일 스위치(새로운 로그파일 생성)
	3. 새로 생성한 로그 파일에 파일 키를 생성하고, 파일키는 바이너리 로그 파일 키(마스터 키)로 암호화해서 각각의 헤더에 저장
	4. 기존 바이너리 로그와 릴레이 로그 파일을 읽어서 새로 만든 바이너리 로그 파일 키로 암호화해서 저장한다.
	5. 기존에 남아있던 바이너리 로그 암호화 키는 키링 파일에서 제거한다.


바이너리 로그 파일이 암호화가 되어있는지 확인한다.
~~~shell
Mysql> SHOW BINARY LOGS;
~~~

### 특징
트랜잭션의 내용을 추적하거나 백업 복구를 위해 암호화된 바이너리 로그 파일을 복호화할 일이 자주 발생한다.
하지만 이를 복호화 하려면 바이너리 암호화 키가 필요한데 이를 Mysql서버가 가지고 있으므로 복호화할 수 없다. 

따라서 mysqlbinlog 툴을 사용해서 읽어보려면 에러 메시지가 발생한다.
~~~shell
Linux> mysqlbinlog -vvv mysql-bin.000011
~~~
그래서 예전처럼 다른 서버로 복사하거나 바이너리 로그 파일을 백업하는 것이 소용없어졌다. 
그래도 확인을 해야하긴 함으로 Mysql서버를 이용해서 가져오는 방법이 있다. 
바로 mysqlbinlog가 mysql서버에 접속해서 바이너리 로그를 가져오게 하는 것이다.

~~~shell
Linux> mysqlbinlog --read-from-remote-server -uroot -p -vvv mysql-bin.000011
~~~
