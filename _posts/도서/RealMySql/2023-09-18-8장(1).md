---
title: RealMySql 8.0 - 디스크 읽기 방식
date: 2023-09-18
categories: [도서, RealMySql]
tags: [mysql, RealMySql, 디스크, 랜덤I/O, 순차I/O, 쿼리튜닝]
math: true
mermaid: true
---

요즘에는 하드웨어도 HDD 보다는 SSD를 많이 사용하는 편이다. 
HDD는 물리적으로 데이터 저장용 플래터(원판)이 돌면서 동작하기 때문에 처리 속도 측면에서 느릴 수 밖에없다. 
하지만 SSD는 전자식으로 저장하기 때문에 HDD보다 상대적으로 처리속도가 빠르다. 

디스크에 대해서 말하는 이유는 디스크 읽기 방식인 랜덤 I/O, 순차 I/O 개념 때문이다.
결국 DB의 성능 튜닝이 어떻게 디스크 I/O를 줄이냐가 포인트이기 때문이다.

SSD는 순차 I/O측면으로만 보았을때 HDD와 드라마틱한 성능차이는 없지만 그래도 높긴 하다. 
 대부분의 요청은 랜덤 I/O이고 이 랜덤 I/O는 HDD보다 훨씬 빠르게 처리한다. 

그렇다면 랜덤 I/O와 순차 I/O가 무엇일까?🤔



## 랜덤 I/O와 순차 I/O

랜덤인지 순차인지 가장 큰 차이는 디스크 헤더를 이동시키는 횟수에 달려있다. 


요청 당 디스크 헤더를 이동시키는 횟수
- 랜덤 I/O	: 요청에 대한 페이지 갯수만큼
- 순차 I/O	: 1번


그렇다면 요청을 많이하는 것보다 순차 I/O가 한번 요청하니 더 좋은거 아닌가? 라고 생각할 수 있다. 
물론 맞다. 디스크의 성능은 디스크 헤더의 위치 이동없이 얼마나 많은 데이터를 쓰고 읽을 수 있는지에 달려있다.

HDD, SSD 둘다 순차, 랜덤 I/O작업을 하며 SSD는 물리적으로 원판이 없어서 순차 I/O가 상대적으로 빠를 수 있다. 또한 SSD도 랜덤 I/O보다는 순차 I/O의 성능이 더 좋다. 

쓰기 I/O가 발생하면 반드시 동기화 작업(fsync, flush)을 해야한다. 순차 I/O작업에도 동기화 작업이 빈번하게 일어난다면 랜덤 I/O처럼 동작할 수 있다. 해서 일반적으로 기업용으로 사용하는 DB서버는 RAID컨트롤러가 사용되며, 이 부하를 RAID 컨트롤러가 사용하는 캐시메모리가 순차 I/O를 효율적으로 처리할 수 있도록 도와준다. 


### 쿼리 튜닝
일반적으로 쿼리 튜닝이라 함은 랜덤 I/O였던것을 순차 I/O로 바꾸는 것을 말하는게 아니다.
랜덤 I/O의 수를 줄이는 것이 목적이라 할 수 있다. 따라서 꼭 필요한 데이터만 조회하는 것이 좋다.

- 인덱스 레인지 스캔 : 랜덤 I/O
- 풀 테이블 스캔 : 순차 I/O

인덱스 레인지 스캔
- Where절을 사용하여 조건절을 추가하여 검색할때
- 임의의 데이터 추가, 삭제

풀 테이블 스캔
- 특정 테이블의 데이터를 모두 조회할때 

순차 I/O가 랜덤 I/O보다는 훨씬 빨리 레코드를 읽어올 수 있지만 OLTP(on-line transaction processing)에서는 모든 테이블을 조회하는 요청보다는 인덱스 레인지 스캔을 더 많이 사용하기 때문에 랜덤 I/O가 더 많이 일어난다. 
